// http-parser-js@0.5.9 downloaded from https://ga.jspm.io/npm:http-parser-js@0.5.9/http-parser.js

var e=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var t={};t.HTTPParser=HTTPParser;function HTTPParser(t){if(t!==void 0&&t!==HTTPParser.REQUEST&&t!==HTTPParser.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");t===void 0||this.initialize(t);(this||e).maxHeaderSize=HTTPParser.maxHeaderSize}HTTPParser.prototype.initialize=function(t,r){if(t!==HTTPParser.REQUEST&&t!==HTTPParser.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");(this||e).type=t;(this||e).state=t+"_LINE";(this||e).info={headers:[],upgrade:false};(this||e).trailers=[];(this||e).line="";(this||e).isChunked=false;(this||e).connection="";(this||e).headerSize=0;(this||e).body_bytes=null;(this||e).isUserCall=false;(this||e).hadError=false};HTTPParser.encoding="ascii";HTTPParser.maxHeaderSize=81920;HTTPParser.REQUEST="REQUEST";HTTPParser.RESPONSE="RESPONSE";var r=HTTPParser.kOnHeaders=1;var s=HTTPParser.kOnHeadersComplete=2;var i=HTTPParser.kOnBody=3;var o=HTTPParser.kOnMessageComplete=4;HTTPParser.prototype[r]=HTTPParser.prototype[s]=HTTPParser.prototype[i]=HTTPParser.prototype[o]=function(){};var a=true;Object.defineProperty(HTTPParser,"kOnExecute",{get:function(){a=false;return 99}});var n=t.methods=HTTPParser.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"];var h=n.indexOf("CONNECT");HTTPParser.prototype.reinitialize=HTTPParser;HTTPParser.prototype.close=HTTPParser.prototype.pause=HTTPParser.prototype.resume=HTTPParser.prototype.remove=HTTPParser.prototype.free=function(){};HTTPParser.prototype._compatMode0_11=false;HTTPParser.prototype.getAsyncId=function(){return 0};var T={REQUEST_LINE:true,RESPONSE_LINE:true,HEADER:true};HTTPParser.prototype.execute=function(t,r,s){if(!((this||e)instanceof HTTPParser))throw new TypeError("not a HTTPParser");r=r||0;s=typeof s==="number"?s:t.length;(this||e).chunk=t;(this||e).offset=r;var i=(this||e).end=r+s;try{while((this||e).offset<i)if(this[(this||e).state]())break}catch(t){if((this||e).isUserCall)throw t;(this||e).hadError=true;return t}(this||e).chunk=null;s=(this||e).offset-r;if(T[(this||e).state]){(this||e).headerSize+=s;if((this||e).headerSize>((this||e).maxHeaderSize||HTTPParser.maxHeaderSize))return new Error("max header size exceeded")}return s};var P={REQUEST_LINE:true,RESPONSE_LINE:true,BODY_RAW:true};HTTPParser.prototype.finish=function(){if(!(this||e).hadError){if(!P[(this||e).state])return new Error("invalid state for EOF");(this||e).state==="BODY_RAW"&&this.userCall()(this[o]())}};HTTPParser.prototype.consume=HTTPParser.prototype.unconsume=HTTPParser.prototype.getCurrentBuffer=function(){};HTTPParser.prototype.userCall=function(){(this||e).isUserCall=true;var t=this||e;return function(e){t.isUserCall=false;return e}};HTTPParser.prototype.nextRequest=function(){this.userCall()(this[o]());this.reinitialize((this||e).type)};HTTPParser.prototype.consumeLine=function(){var t=(this||e).end,r=(this||e).chunk;for(var s=(this||e).offset;s<t;s++)if(r[s]===10){var i=(this||e).line+r.toString(HTTPParser.encoding,(this||e).offset,s);i.charAt(i.length-1)==="\r"&&(i=i.substr(0,i.length-1));(this||e).line="";(this||e).offset=s+1;return i}(this||e).line+=r.toString(HTTPParser.encoding,(this||e).offset,(this||e).end);(this||e).offset=(this||e).end};var f=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/;var u=/^[ \t]+(.*[^ \t])/;HTTPParser.prototype.parseHeader=function(e,t){if(e.indexOf("\r")!==-1)throw parseErrorCode("HPE_LF_EXPECTED");var r=f.exec(e);var s=r&&r[1];if(s){t.push(s);t.push(r[2])}else{var i=u.exec(e);if(i&&t.length){t[t.length-1]&&(t[t.length-1]+=" ");t[t.length-1]+=i[1]}}};var d=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;HTTPParser.prototype.REQUEST_LINE=function(){var t=this.consumeLine();if(t){var r=d.exec(t);if(r===null)throw parseErrorCode("HPE_INVALID_CONSTANT");(this||e).info.method=(this||e)._compatMode0_11?r[1]:n.indexOf(r[1]);if((this||e).info.method===-1)throw new Error("invalid request method");(this||e).info.url=r[2];(this||e).info.versionMajor=+r[3];(this||e).info.versionMinor=+r[4];(this||e).body_bytes=0;(this||e).state="HEADER"}};var E=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;HTTPParser.prototype.RESPONSE_LINE=function(){var t=this.consumeLine();if(t){var r=E.exec(t);if(r===null)throw parseErrorCode("HPE_INVALID_CONSTANT");(this||e).info.versionMajor=+r[1];(this||e).info.versionMinor=+r[2];var s=(this||e).info.statusCode=+r[3];(this||e).info.statusMessage=r[4];(s/100|0)!==1&&s!==204&&s!==304||((this||e).body_bytes=0);(this||e).state="HEADER"}};HTTPParser.prototype.shouldKeepAlive=function(){if((this||e).info.versionMajor>0&&(this||e).info.versionMinor>0){if((this||e).connection.indexOf("close")!==-1)return false}else if((this||e).connection.indexOf("keep-alive")===-1)return false;return!((this||e).body_bytes===null&&!(this||e).isChunked)};HTTPParser.prototype.HEADER=function(){var t=this.consumeLine();if(t!==void 0){var r=(this||e).info;if(t)this.parseHeader(t,r.headers);else{var i=r.headers;var o=false;var n;var T=false;for(var P=0;P<i.length;P+=2)switch(i[P].toLowerCase()){case"transfer-encoding":(this||e).isChunked=i[P+1].toLowerCase()==="chunked";break;case"content-length":n=+i[P+1];if(o){if(n!==(this||e).body_bytes)throw parseErrorCode("HPE_UNEXPECTED_CONTENT_LENGTH")}else{o=true;(this||e).body_bytes=n}break;case"connection":(this||e).connection+=i[P+1].toLowerCase();break;case"upgrade":T=true;break}if((this||e).isChunked&&o){o=false;(this||e).body_bytes=null}T&&(this||e).connection.indexOf("upgrade")!=-1?r.upgrade=(this||e).type===HTTPParser.REQUEST||r.statusCode===101:r.upgrade=r.method===h;(this||e).isChunked&&r.upgrade&&((this||e).isChunked=false);r.shouldKeepAlive=this.shouldKeepAlive();var f;f=a?this.userCall()(this[s](r)):this.userCall()(this[s](r.versionMajor,r.versionMinor,r.headers,r.method,r.url,r.statusCode,r.statusMessage,r.upgrade,r.shouldKeepAlive));if(f===2){this.nextRequest();return true}if((this||e).isChunked&&!f)(this||e).state="BODY_CHUNKHEAD";else{if(f||(this||e).body_bytes===0){this.nextRequest();return r.upgrade}(this||e).body_bytes===null?(this||e).state="BODY_RAW":(this||e).state="BODY_SIZED"}}}};HTTPParser.prototype.BODY_CHUNKHEAD=function(){var t=this.consumeLine();if(t!==void 0){(this||e).body_bytes=parseInt(t,16);(this||e).body_bytes?(this||e).state="BODY_CHUNK":(this||e).state="BODY_CHUNKTRAILERS"}};HTTPParser.prototype.BODY_CHUNK=function(){var t=Math.min((this||e).end-(this||e).offset,(this||e).body_bytes);this.userCall()(this[i]((this||e).chunk.slice((this||e).offset,(this||e).offset+t),0,t));(this||e).offset+=t;(this||e).body_bytes-=t;(this||e).body_bytes||((this||e).state="BODY_CHUNKEMPTYLINE")};HTTPParser.prototype.BODY_CHUNKEMPTYLINE=function(){var t=this.consumeLine();if(t!==void 0){if(t!=="")throw new Error("Expected empty line");(this||e).state="BODY_CHUNKHEAD"}};HTTPParser.prototype.BODY_CHUNKTRAILERS=function(){var t=this.consumeLine();if(t!==void 0)if(t)this.parseHeader(t,(this||e).trailers);else{(this||e).trailers.length&&this.userCall()(this[r]((this||e).trailers,""));this.nextRequest()}};HTTPParser.prototype.BODY_RAW=function(){this.userCall()(this[i]((this||e).chunk.slice((this||e).offset,(this||e).end),0,(this||e).end-(this||e).offset));(this||e).offset=(this||e).end};HTTPParser.prototype.BODY_SIZED=function(){var t=Math.min((this||e).end-(this||e).offset,(this||e).body_bytes);this.userCall()(this[i]((this||e).chunk.slice((this||e).offset,(this||e).offset+t),0,t));(this||e).offset+=t;(this||e).body_bytes-=t;(this||e).body_bytes||this.nextRequest()};["Headers","HeadersComplete","Body","MessageComplete"].forEach((function(t){var r=HTTPParser["kOn"+t];Object.defineProperty(HTTPParser.prototype,"on"+t,{get:function(){return(this||e)[r]},set:function(t){(this||e)._compatMode0_11=true;h="CONNECT";return(this||e)[r]=t}})}));function parseErrorCode(e){var t=new Error("Parse Error");t.code=e;return t}const l=t.HTTPParser,p=t.methods;export{l as HTTPParser,t as default,p as methods};

