// chokidar@2.1.8 downloaded from https://ga.jspm.io/npm:chokidar@2.1.8/index.js

import t from"events";import e from"fs";import i from"path";import r from"async-each";import n from"anymatch";import s from"glob-parent";import a from"is-glob";import o from"path-is-absolute";import h from"inherits";import l from"braces";import c from"normalize-path";import d from"upath";import u from"readdirp";import f from"is-binary-path";import v from"process";import p from"fsevents";var m={};var _=v;var g=e;var y=i;var b=u;var w=f;var F=Object.create(null);function createFsWatchInstance(t,e,i,r,n){var handleEvent=function(e,r){i(t);n(e,r,{watchedPath:t});r&&t!==r&&fsWatchBroadcast(y.resolve(t,r),"listeners",y.join(t,r))};try{return g.watch(t,e,handleEvent)}catch(t){r(t)}}function fsWatchBroadcast(t,e,i,r,n){F[t]&&F[t][e].forEach((function(t){t(i,r,n)}))}function setFsWatchListener(t,e,i,r){var n=r.listener;var s=r.errHandler;var a=r.rawEmitter;var o=F[e];var h;if(!i.persistent){h=createFsWatchInstance(t,i,n,s,a);return h.close.bind(h)}if(o){o.listeners.push(n);o.errHandlers.push(s);o.rawEmitters.push(a)}else{h=createFsWatchInstance(t,i,fsWatchBroadcast.bind(null,e,"listeners"),s,fsWatchBroadcast.bind(null,e,"rawEmitters"));if(!h)return;var l=fsWatchBroadcast.bind(null,e,"errHandlers");h.on("error",(function(e){o.watcherUnusable=true;"win32"===_.platform&&"EPERM"===e.code?g.open(t,"r",(function(t,i){t||g.close(i,(function(t){t||l(e)}))})):l(e)}));o=F[e]={listeners:[n],errHandlers:[s],rawEmitters:[a],watcher:h}}var c=o.listeners.length-1;return function close(){delete o.listeners[c];delete o.errHandlers[c];delete o.rawEmitters[c];if(!Object.keys(o.listeners).length){o.watcherUnusable||o.watcher.close();delete F[e]}}}var E=Object.create(null);function setFsWatchFileListener(t,e,i,r){var n=r.listener;var s=r.rawEmitter;var a=E[e];var o=[];var h=[];if(a&&(a.options.persistent<i.persistent||a.options.interval>i.interval)){o=a.listeners;h=a.rawEmitters;g.unwatchFile(e);a=false}if(a){a.listeners.push(n);a.rawEmitters.push(s)}else{o.push(n);h.push(s);a=E[e]={listeners:o,rawEmitters:h,options:i,watcher:g.watchFile(e,i,(function(i,r){a.rawEmitters.forEach((function(t){t("change",e,{curr:i,prev:r})}));var n=i.mtime.getTime();(i.size!==r.size||n>r.mtime.getTime()||0===n)&&a.listeners.forEach((function(e){e(t,i)}))}))}}var l=a.listeners.length-1;return function close(){delete a.listeners[l];delete a.rawEmitters[l];if(!Object.keys(a.listeners).length){g.unwatchFile(e);delete E[e]}}}function NodeFsHandler(){}NodeFsHandler.prototype._watchWithNodeFs=function(t,e){var i=y.dirname(t);var r=y.basename(t);var n=this._getWatchedDir(i);n.add(r);var s=y.resolve(t);var a={persistent:this.options.persistent};e||(e=Function.prototype);var o;if(this.options.usePolling){a.interval=this.enableBinaryInterval&&w(r)?this.options.binaryInterval:this.options.interval;o=setFsWatchFileListener(t,s,a,{listener:e,rawEmitter:this.emit.bind(this,"raw")})}else o=setFsWatchListener(t,s,a,{listener:e,errHandler:this._handleError.bind(this),rawEmitter:this.emit.bind(this,"raw")});return o};NodeFsHandler.prototype._handleFile=function(t,e,i,r){var n=y.dirname(t);var s=y.basename(t);var a=this._getWatchedDir(n);var o=e;if(a.has(s))return r();var h=this._watchWithNodeFs(t,function(e,i){if(this._throttle("watch",t,5))if(!i||i&&0===i.mtime.getTime())g.stat(t,function(e,i){if(e)this._remove(n,s);else{var r=i.atime.getTime();var a=i.mtime.getTime();(!r||r<=a||a!==o.mtime.getTime())&&this._emit("change",t,i);o=i}}.bind(this));else if(a.has(s)){var r=i.atime.getTime();var h=i.mtime.getTime();(!r||r<=h||h!==o.mtime.getTime())&&this._emit("change",t,i);o=i}}.bind(this));if(!(i&&this.options.ignoreInitial)){if(!this._throttle("add",t,0))return;this._emit("add",t,e)}r&&r();return h};NodeFsHandler.prototype._handleSymlink=function(t,e,i,r){var n=t.fullPath;var s=this._getWatchedDir(e);if(!this.options.followSymlinks){this._readyCount++;g.realpath(i,function(e,a){if(s.has(r)){if(this._symlinkPaths[n]!==a){this._symlinkPaths[n]=a;this._emit("change",i,t.stat)}}else{s.add(r);this._symlinkPaths[n]=a;this._emit("add",i,t.stat)}this._emitReady()}.bind(this));return true}if(this._symlinkPaths[n])return true;this._symlinkPaths[n]=true};NodeFsHandler.prototype._handleDir=function(t,e,i,r,n,s,a){var o=this._getWatchedDir(y.dirname(t));var h=o.has(y.basename(t));i&&this.options.ignoreInitial||n||h||s.hasGlob&&!s.globFilter(t)||this._emit("addDir",t,e);o.add(y.basename(t));this._getWatchedDir(t);var l=function(e,i,a){e=y.join(e,"");if(!s.hasGlob){var o=this._throttle("readdir",e,1e3);if(!o)return}var h=this._getWatchedDir(s.path);var c=[];b({root:e,entryType:"all",fileFilter:s.filterPath,directoryFilter:s.filterDir,depth:0,lstat:true}).on("data",function(a){var o=a.path;var l=y.join(e,o);c.push(o);if((!a.stat.isSymbolicLink()||!this._handleSymlink(a,e,l,o))&&(o===n||!n&&!h.has(o))){this._readyCount++;l=y.join(t,y.relative(t,l));this._addToNodeFs(l,i,s,r+1)}}.bind(this)).on("end",function(){var t=!!o&&o.clear();a&&a();h.children().filter((function(t){return t!==e&&-1===c.indexOf(t)&&(!s.hasGlob||s.filterPath({fullPath:y.resolve(e,t)}))})).forEach((function(t){this._remove(e,t)}),this);t&&l(e,false)}.bind(this)).on("error",this._handleError.bind(this))}.bind(this);var c;if(null==this.options.depth||r<=this.options.depth){n||l(t,i,a);c=this._watchWithNodeFs(t,(function(t,e){e&&0===e.mtime.getTime()||l(t,false)}))}else a();return c};NodeFsHandler.prototype._addToNodeFs=function(t,e,i,r,n,s){s||(s=Function.prototype);var a=this._emitReady;if(this._isIgnored(t)||this.closed){a();return s(null,false)}var o=this._getWatchHelpers(t,r);if(!o.hasGlob&&i){o.hasGlob=i.hasGlob;o.globFilter=i.globFilter;o.filterPath=i.filterPath;o.filterDir=i.filterDir}g[o.statMethod](o.watchPath,function(i,h){if(this._handleError(i))return s(null,t);if(this._isIgnored(o.watchPath,h)){a();return s(null,false)}var l=function(t,i){return this._handleDir(t,h,e,r,i,o,a)}.bind(this);var c;if(h.isDirectory())c=l(o.watchPath,n);else if(h.isSymbolicLink()){var d=y.dirname(o.watchPath);this._getWatchedDir(d).add(o.watchPath);this._emit("add",o.watchPath,h);c=l(d,t);g.realpath(t,function(e,i){this._symlinkPaths[y.resolve(t)]=i;a()}.bind(this))}else c=this._handleFile(o.watchPath,h,e,a);if(c){this._closers[t]=this._closers[t]||[];this._closers[t].push(c)}s(null,false)}.bind(this))};m=NodeFsHandler;var W=m;var P={};var k=v;var I=e;var O=i;var S=u;var j;try{j=p}catch(t){k.env.CHOKIDAR_PRINT_FSEVENTS_REQUIRE_ERROR&&console.error(t)}var D=Object.create(null);var T=10;function createFSEventsInstance(t,e){return new j(t).on("fsevent",e).start()}function setFSEventsListener(t,e,i,r){var n=O.extname(t)?O.dirname(t):t;var s;var a=O.dirname(n);couldConsolidate(a)&&(n=a);var o=O.resolve(t);var h=o!==e;function filteredListener(t,r,n){h&&(t=t.replace(e,o));t!==o&&t.indexOf(o+O.sep)||i(t,r,n)}function watchedParent(){return Object.keys(D).some((function(t){if(!e.indexOf(O.resolve(t)+O.sep)){n=t;return true}}))}if(n in D||watchedParent()){s=D[n];s.listeners.push(filteredListener)}else s=D[n]={listeners:[filteredListener],rawEmitters:[r],watcher:createFSEventsInstance(n,(function(t,e){var i=j.getInfo(t,e);s.listeners.forEach((function(r){r(t,e,i)}));s.rawEmitters.forEach((function(e){e(i.event,t,i)}))}))};var l=s.listeners.length-1;return function close(){delete s.listeners[l];delete s.rawEmitters[l];if(!Object.keys(s.listeners).length){s.watcher.stop();delete D[n]}}}function couldConsolidate(t){var e=Object.keys(D);var i=0;for(var r=0,n=e.length;r<n;++r){var s=e[r];if(0===s.indexOf(t)){i++;if(i>=T)return true}}return false}function isConstructor(t){return void 0!==t.prototype&&void 0!==t.prototype.constructor}function canUse(){return j&&Object.keys(D).length<128&&isConstructor(j)}function depth(t,e){var i=0;while(!t.indexOf(e)&&(t=O.dirname(t))!==e)i++;return i}function FsEventsHandler(){}FsEventsHandler.prototype._watchWithFsEvents=function(t,e,i,r){if(!this._isIgnored(t)){var n=function(n,s,a){if(!(void 0!==this.options.depth&&depth(n,e)>this.options.depth)){var o=i(O.join(t,O.relative(t,n)));if(!r||r(o)){var h=O.dirname(o);var l=O.basename(o);var c=this._getWatchedDir("directory"===a.type?o:h);var d=function(t){if(this._isIgnored(o,t)){this._ignoredPaths[o]=true;t&&t.isDirectory()&&(this._ignoredPaths[o+"/**/*"]=true);return true}delete this._ignoredPaths[o];delete this._ignoredPaths[o+"/**/*"]}.bind(this);var u=function(t){if(!d())if("unlink"===t)("directory"===a.type||c.has(l))&&this._remove(h,l);else{if("add"===t){"directory"===a.type&&this._getWatchedDir(o);if("symlink"===a.type&&this.options.followSymlinks){var i=void 0===this.options.depth?void 0:depth(n,e)+1;return this._addToFsEvents(o,false,true,i)}this._getWatchedDir(h).add(l)}var r="directory"===a.type?t+"Dir":t;this._emit(r,o);"addDir"===r&&this._addToFsEvents(o,false,true)}}.bind(this);var f=[69888,70400,71424,72704,73472,131328,131840,262912];if(-1!==f.indexOf(s)||"unknown"===a.event)"function"===typeof this.options.ignored?I.stat(o,(function(t,e){d(e)||(e?addOrChange():u("unlink"))})):checkFd();else switch(a.event){case"created":case"modified":return addOrChange();case"deleted":case"moved":return checkFd()}}}function addOrChange(){u(c.has(l)?"change":"add")}function checkFd(){I.open(o,"r",(function(t,e){t?"EACCES"!==t.code?u("unlink"):addOrChange():I.close(e,(function(t){t&&"EACCES"!==t.code?u("unlink"):addOrChange()}))}))}}.bind(this);var s=setFSEventsListener(t,e,n,this.emit.bind(this,"raw"));this._emitReady();return s}};FsEventsHandler.prototype._handleFsEventsSymlink=function(t,e,i,r){if(!this._symlinkPaths[e]){this._symlinkPaths[e]=true;this._readyCount++;I.realpath(t,function(e,n){if(this._handleError(e)||this._isIgnored(n))return this._emitReady();this._readyCount++;this._addToFsEvents(n||t,(function(e){var r="."+O.sep;var s=t;n&&n!==r?s=e.replace(n,t):e!==r&&(s=O.join(t,e));return i(s)}),false,r)}.bind(this))}};FsEventsHandler.prototype._addToFsEvents=function(t,e,i,r){var n="function"===typeof e?e:function(t){return t};var s=function(t,e){var r=n(t);var s=e.isDirectory();var a=this._getWatchedDir(O.dirname(r));var o=O.basename(r);s&&this._getWatchedDir(r);if(!a.has(o)){a.add(o);this.options.ignoreInitial&&true!==i||this._emit(s?"addDir":"add",r,e)}}.bind(this);var a=this._getWatchHelpers(t);I[a.statMethod](a.watchPath,function(e,i){if(this._handleError(e)||this._isIgnored(a.watchPath,i)){this._emitReady();return this._emitReady()}if(i.isDirectory()){a.globFilter||s(n(t),i);if(r&&r>this.options.depth)return;S({root:a.watchPath,entryType:"all",fileFilter:a.filterPath,directoryFilter:a.filterDir,lstat:true,depth:this.options.depth-(r||0)}).on("data",function(t){if(!t.stat.isDirectory()||a.filterPath(t)){var e=O.join(a.watchPath,t.path);var i=t.fullPath;if(a.followSymlinks&&t.stat.isSymbolicLink()){var r=void 0===this.options.depth?void 0:depth(e,O.resolve(a.watchPath))+1;this._handleFsEventsSymlink(e,i,n,r)}else s(e,t.stat)}}.bind(this)).on("error",(function(){})).on("end",this._emitReady)}else{s(a.watchPath,i);this._emitReady()}}.bind(this));if(this.options.persistent&&true!==i){var o=function(e,i){if(!this.closed){var r=this._watchWithFsEvents(a.watchPath,O.resolve(i||a.watchPath),n,a.globFilter);if(r){this._closers[t]=this._closers[t]||[];this._closers[t].push(r)}}}.bind(this);"function"===typeof e?o():I.realpath(a.watchPath,o)}};P=FsEventsHandler;P.canUse=canUse;var C=P;var H={};var R=v;var N=t.EventEmitter;var L=e;var U=i;var x=r;var A=n;var G=s;var B=a;var z=o;var M=h;var K=l;var V=c;var $=d;var Q=W;var q=C;var arrify=function(t){return null==t?[]:Array.isArray(t)?t:[t]};var flatten=function(t,e){null==e&&(e=[]);t.forEach((function(t){Array.isArray(t)?flatten(t,e):e.push(t)}));return e};var isString=function(t){return"string"===typeof t};function FSWatcher(t){N.call(this);var e={};if(t)for(var i in t)e[i]=t[i];this._watched=Object.create(null);this._closers=Object.create(null);this._ignoredPaths=Object.create(null);Object.defineProperty(this,"_globIgnored",{get:function(){return Object.keys(this._ignoredPaths)}});this.closed=false;this._throttled=Object.create(null);this._symlinkPaths=Object.create(null);function undef(t){return void 0===e[t]}undef("persistent")&&(e.persistent=true);undef("ignoreInitial")&&(e.ignoreInitial=false);undef("ignorePermissionErrors")&&(e.ignorePermissionErrors=false);undef("interval")&&(e.interval=100);undef("binaryInterval")&&(e.binaryInterval=300);undef("disableGlobbing")&&(e.disableGlobbing=false);this.enableBinaryInterval=e.binaryInterval!==e.interval;undef("useFsEvents")&&(e.useFsEvents=!e.usePolling);q.canUse()||(e.useFsEvents=false);undef("usePolling")&&!e.useFsEvents&&(e.usePolling="darwin"===R.platform);var r=R.env.CHOKIDAR_USEPOLLING;if(void 0!==r){var n=r.toLowerCase();e.usePolling="false"!==n&&"0"!==n&&("true"===n||"1"===n||!!n)}var s=R.env.CHOKIDAR_INTERVAL;s&&(e.interval=parseInt(s));undef("atomic")&&(e.atomic=!e.usePolling&&!e.useFsEvents);e.atomic&&(this._pendingUnlinks=Object.create(null));undef("followSymlinks")&&(e.followSymlinks=true);undef("awaitWriteFinish")&&(e.awaitWriteFinish=false);true===e.awaitWriteFinish&&(e.awaitWriteFinish={});var a=e.awaitWriteFinish;if(a){a.stabilityThreshold||(a.stabilityThreshold=2e3);a.pollInterval||(a.pollInterval=100);this._pendingWrites=Object.create(null)}e.ignored&&(e.ignored=arrify(e.ignored));this._isntIgnored=function(t,e){return!this._isIgnored(t,e)}.bind(this);var o=0;this._emitReady=function(){if(++o>=this._readyCount){this._emitReady=Function.prototype;this._readyEmitted=true;R.nextTick(this.emit.bind(this,"ready"))}}.bind(this);this.options=e;Object.freeze(e)}M(FSWatcher,N);FSWatcher.prototype._emit=function(t,e,i,r,n){this.options.cwd&&(e=U.relative(this.options.cwd,e));var s=[t,e];void 0!==n?s.push(i,r,n):void 0!==r?s.push(i,r):void 0!==i&&s.push(i);var a=this.options.awaitWriteFinish;if(a&&this._pendingWrites[e]){this._pendingWrites[e].lastChange=new Date;return this}if(this.options.atomic){if("unlink"===t){this._pendingUnlinks[e]=s;setTimeout(function(){Object.keys(this._pendingUnlinks).forEach(function(t){this.emit.apply(this,this._pendingUnlinks[t]);this.emit.apply(this,["all"].concat(this._pendingUnlinks[t]));delete this._pendingUnlinks[t]}.bind(this))}.bind(this),"number"===typeof this.options.atomic?this.options.atomic:100);return this}if("add"===t&&this._pendingUnlinks[e]){t=s[0]="change";delete this._pendingUnlinks[e]}}var o=function(){this.emit.apply(this,s);"error"!==t&&this.emit.apply(this,["all"].concat(s))}.bind(this);if(a&&("add"===t||"change"===t)&&this._readyEmitted){var awfEmit=function(e,i){if(e){t=s[0]="error";s[1]=e;o()}else if(i){s.length>2?s[2]=i:s.push(i);o()}};this._awaitWriteFinish(e,a.stabilityThreshold,t,awfEmit);return this}if("change"===t&&!this._throttle("change",e,50))return this;if(!this.options.alwaysStat||void 0!==i||"add"!==t&&"addDir"!==t&&"change"!==t)o();else{var h=this.options.cwd?U.join(this.options.cwd,e):e;L.stat(h,(function(t,e){if(!t&&e){s.push(e);o()}}))}return this};FSWatcher.prototype._handleError=function(t){var e=t&&t.code;var i=this.options.ignorePermissionErrors;t&&"ENOENT"!==e&&"ENOTDIR"!==e&&(!i||"EPERM"!==e&&"EACCES"!==e)&&this.emit("error",t);return t||this.closed};FSWatcher.prototype._throttle=function(t,e,i){t in this._throttled||(this._throttled[t]=Object.create(null));var r=this._throttled[t];if(e in r){r[e].count++;return false}function clear(){var t=r[e]?r[e].count:0;delete r[e];clearTimeout(n);return t}var n=setTimeout(clear,i);r[e]={timeoutObject:n,clear:clear,count:0};return r[e]};FSWatcher.prototype._awaitWriteFinish=function(t,e,i,r){var n;var s=t;this.options.cwd&&!z(t)&&(s=U.join(this.options.cwd,t));var a=new Date;var o=function(i){L.stat(s,function(s,a){if(!s&&t in this._pendingWrites){var h=new Date;i&&a.size!=i.size&&(this._pendingWrites[t].lastChange=h);if(h-this._pendingWrites[t].lastChange>=e){delete this._pendingWrites[t];r(null,a)}else n=setTimeout(o.bind(this,a),this.options.awaitWriteFinish.pollInterval)}else s&&"ENOENT"!==s.code&&r(s)}.bind(this))}.bind(this);if(!(t in this._pendingWrites)){this._pendingWrites[t]={lastChange:a,cancelWait:function(){delete this._pendingWrites[t];clearTimeout(n);return i}.bind(this)};n=setTimeout(o.bind(this),this.options.awaitWriteFinish.pollInterval)}};var J=/\..*\.(sw[px])$|\~$|\.subl.*\.tmp/;FSWatcher.prototype._isIgnored=function(t,e){if(this.options.atomic&&J.test(t))return true;if(!this._userIgnored){var i=this.options.cwd;var r=this.options.ignored;i&&r&&(r=r.map((function(t){return"string"!==typeof t?t:$.normalize(z(t)?t:U.join(i,t))})));var n=arrify(r).filter((function(t){return"string"===typeof t&&!B(t)})).map((function(t){return t+"/**"}));this._userIgnored=A(this._globIgnored.concat(r).concat(n))}return this._userIgnored([t,e])};var X=/^\.[\/\\]/;FSWatcher.prototype._getWatchHelpers=function(t,e){t=t.replace(X,"");var i=e||this.options.disableGlobbing||!B(t)?t:G(t);var r=U.resolve(i);var n=i!==t;var s=!!n&&A(t);var a=this.options.followSymlinks;var o=!(!n||!a)&&null;var checkGlobSymlink=function(t){null==o&&(o=t.fullParentDir!==r&&{realPath:t.fullParentDir,linkPath:r});return o?t.fullPath.replace(o.realPath,o.linkPath):t.fullPath};var entryPath=function(t){return U.join(i,U.relative(i,checkGlobSymlink(t)))};var h=function(t){if(t.stat&&t.stat.isSymbolicLink())return d(t);var e=entryPath(t);return(!n||s(e))&&this._isntIgnored(e,t.stat)&&(this.options.ignorePermissionErrors||this._hasReadPermissions(t.stat))}.bind(this);var getDirParts=function(t){if(!n)return false;var e=[];var r=K.expand(t);r.forEach((function(t){e.push(U.relative(i,t).split(/[\/\\]/))}));return e};var l=getDirParts(t);l&&l.forEach((function(t){t.length>1&&t.pop()}));var c;var d=function(t){if(n){var e=getDirParts(checkGlobSymlink(t));var i=false;c=!l.some((function(t){return t.every((function(t,r){"**"===t&&(i=true);return i||!e[0][r]||A(t,e[0][r])}))}))}return!c&&this._isntIgnored(entryPath(t),t.stat)}.bind(this);return{followSymlinks:a,statMethod:a?"stat":"lstat",path:t,watchPath:i,entryPath:entryPath,hasGlob:n,globFilter:s,filterPath:h,filterDir:d}};FSWatcher.prototype._getWatchedDir=function(t){var e=U.resolve(t);var i=this._remove.bind(this);e in this._watched||(this._watched[e]={_items:Object.create(null),add:function(t){"."!==t&&".."!==t&&(this._items[t]=true)},remove:function(t){delete this._items[t];this.children().length||L.readdir(e,(function(t){t&&i(U.dirname(e),U.basename(e))}))},has:function(t){return t in this._items},children:function(){return Object.keys(this._items)}});return this._watched[e]};FSWatcher.prototype._hasReadPermissions=function(t){return Boolean(4&parseInt((511&(t&&t.mode)).toString(8)[0],10))};FSWatcher.prototype._remove=function(t,e){var i=U.join(t,e);var r=U.resolve(i);var n=this._watched[i]||this._watched[r];if(this._throttle("remove",i,100)){var s=Object.keys(this._watched);n||this.options.useFsEvents||1!==s.length||this.add(t,e,true);var a=this._getWatchedDir(i).children();a.forEach((function(t){this._remove(i,t)}),this);var o=this._getWatchedDir(t);var h=o.has(e);o.remove(e);var l=i;this.options.cwd&&(l=U.relative(this.options.cwd,i));if(this.options.awaitWriteFinish&&this._pendingWrites[l]){var c=this._pendingWrites[l].cancelWait();if("add"===c)return}delete this._watched[i];delete this._watched[r];var d=n?"unlinkDir":"unlink";h&&!this._isIgnored(i)&&this._emit(d,i);this.options.useFsEvents||this._closePath(i)}};FSWatcher.prototype._closePath=function(t){if(this._closers[t]){this._closers[t].forEach((function(t){t()}));delete this._closers[t];this._getWatchedDir(U.dirname(t)).remove(U.basename(t))}};FSWatcher.prototype.add=function(t,e,i){var r=this.options.disableGlobbing;var n=this.options.cwd;this.closed=false;t=flatten(arrify(t));if(!t.every(isString))throw new TypeError("Non-string provided as watch path: "+t);n&&(t=t.map((function(t){var e;e=z(t)?t:"!"===t[0]?"!"+U.join(n,t.substring(1)):U.join(n,t);return r||!B(t)?e:V(e)})));t=t.filter((function(t){if("!"!==t[0]){delete this._ignoredPaths[t];delete this._ignoredPaths[t+"/**"];this._userIgnored=null;return true}this._ignoredPaths[t.substring(1)]=true}),this);if(this.options.useFsEvents&&q.canUse()){this._readyCount||(this._readyCount=t.length);this.options.persistent&&(this._readyCount*=2);t.forEach(this._addToFsEvents,this)}else{this._readyCount||(this._readyCount=0);this._readyCount+=t.length;x(t,function(t,r){this._addToNodeFs(t,!i,0,0,e,function(t,e){e&&this._emitReady();r(t,e)}.bind(this))}.bind(this),function(t,i){i.forEach((function(t){t&&!this.closed&&this.add(U.dirname(t),U.basename(e||t))}),this)}.bind(this))}return this};FSWatcher.prototype.unwatch=function(t){if(this.closed)return this;t=flatten(arrify(t));t.forEach((function(t){if(!z(t)&&!this._closers[t]){this.options.cwd&&(t=U.join(this.options.cwd,t));t=U.resolve(t)}this._closePath(t);this._ignoredPaths[t]=true;t in this._watched&&(this._ignoredPaths[t+"/**"]=true);this._userIgnored=null}),this);return this};FSWatcher.prototype.close=function(){if(this.closed)return this;this.closed=true;Object.keys(this._closers).forEach((function(t){this._closers[t].forEach((function(t){t()}));delete this._closers[t]}),this);this._watched=Object.create(null);this.removeAllListeners();return this};FSWatcher.prototype.getWatched=function(){var t={};Object.keys(this._watched).forEach(function(e){var i=this.options.cwd?U.relative(this.options.cwd,e):e;t[i||"."]=Object.keys(this._watched[e]._items).sort()}.bind(this));return t};function importHandler(t){Object.keys(t.prototype).forEach((function(e){FSWatcher.prototype[e]=t.prototype[e]}))}importHandler(Q);q.canUse()&&importHandler(q);H.FSWatcher=FSWatcher;H.watch=function(t,e){return new FSWatcher(e).add(t)};const Y=H.watch;const Z=H.FSWatcher;export default H;export{Z as FSWatcher,Y as watch};

