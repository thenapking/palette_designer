// serve-index@1.9.1 downloaded from https://ga.jspm.io/npm:serve-index@1.9.1/index.js

import e from"accepts";import a from"http-errors";import t from"debug";import n from"escape-html";import p from"fs";import i from"path";import r from"batch";import o from"mime-types";import s from"parseurl";import c from"buffer";var l={};var g=c.Buffer;var m=e;var d=a;var f=t("serve-index");var u=n;var _=p,h=i,v=h.normalize,w=h.sep,x=h.extname,b=h.join;var y=r;var N=o;var j=s;var L=i.resolve;l=serveIndex;var I={};var z=b(new URL(import.meta.url.slice(0,import.meta.url.lastIndexOf("/"))).pathname,"public","directory.html");var O=b(new URL(import.meta.url.slice(0,import.meta.url.lastIndexOf("/"))).pathname,"public","style.css");var S=["text/html","text/plain","application/json"];var C={"text/html":"html","text/plain":"plain","application/json":"json"};function serveIndex(e,a){var t=a||{};if(!e)throw new TypeError("serveIndex() root path required");var n=v(L(e)+w);var p=t.filter;var i=t.hidden;var r=t.icons;var o=t.stylesheet||O;var s=t.template||z;var c=t.view||"tiles";return function(e,a,t){if("GET"===e.method||"HEAD"===e.method){var l=j(e);var g=j.original(e);var u=decodeURIComponent(l.pathname);var h=decodeURIComponent(g.pathname);var x=v(b(n,u));if(~x.indexOf("\0"))return t(d(400));if((x+w).substr(0,n.length)!==n){f('malicious path "%s"',x);return t(d(403))}var y=v(L(x)+w)!==n;f('stat "%s"',x);_.stat(x,(function(n,l){if(n&&"ENOENT"===n.code)return t();if(n){n.status="ENAMETOOLONG"===n.code?414:500;return t(n)}if(!l.isDirectory())return t();f('readdir "%s"',x);_.readdir(x,(function(n,l){if(n)return t(n);i||(l=removeHidden(l));p&&(l=l.filter((function(e,a,t){return p(e,a,t,x)})));l.sort();var g=m(e);var f=g.type(S);if(!f)return t(d(406));serveIndex[C[f]](e,a,l,t,h,y,r,x,c,s,o)}))}))}else{a.statusCode="OPTIONS"===e.method?200:405;a.setHeader("Allow","GET, HEAD, OPTIONS");a.setHeader("Content-Length","0");a.end()}}}serveIndex.html=function _html(e,a,t,n,p,i,r,o,s,c,l){var g="function"!==typeof c?createHtmlRender(c):c;i&&t.unshift("..");stat(o,t,(function(e,i){if(e)return n(e);var c=t.map((function(e,a){return{name:e,stat:i[a]}}));c.sort(fileSort);_.readFile(l,"utf8",(function(e,t){if(e)return n(e);var i={directory:p,displayIcons:Boolean(r),fileList:c,path:o,style:t,viewName:s};g(i,(function(e,t){if(e)return n(e);send(a,"text/html",t)}))}))}))};serveIndex.json=function _json(e,a,t){send(a,"application/json",JSON.stringify(t))};serveIndex.plain=function _plain(e,a,t){send(a,"text/plain",t.join("\n")+"\n")};function createHtmlFileList(e,a,t,n){var p='<ul id="files" class="view-'+u(n)+'">'+("details"==n?'<li class="header">'+'<span class="name">Name</span>'+'<span class="size">Size</span>'+'<span class="date">Modified</span>'+"</li>":"");p+=e.map((function(e){var n=[];var p=e.stat&&e.stat.isDirectory();var i=a.split("/").map((function(e){return encodeURIComponent(e)}));if(t){n.push("icon");if(p)n.push("icon-directory");else{var r=x(e.name);var o=iconLookup(e.name);n.push("icon");n.push("icon-"+r.substring(1));-1===n.indexOf(o.className)&&n.push(o.className)}}i.push(encodeURIComponent(e.name));var s=e.stat&&".."!==e.name?e.stat.mtime.toLocaleDateString()+" "+e.stat.mtime.toLocaleTimeString():"";var c=e.stat&&!p?e.stat.size:"";return'<li><a href="'+u(normalizeSlashes(v(i.join("/"))))+'" class="'+u(n.join(" "))+'"'+' title="'+u(e.name)+'">'+'<span class="name">'+u(e.name)+"</span>"+'<span class="size">'+u(c)+"</span>"+'<span class="date">'+u(s)+"</span>"+"</a></li>"})).join("\n");p+="</ul>";return p}function createHtmlRender(e){return function render(a,t){_.readFile(e,"utf8",(function(e,n){if(e)return t(e);var p=n.replace(/\{style\}/g,a.style.concat(iconStyle(a.fileList,a.displayIcons))).replace(/\{files\}/g,createHtmlFileList(a.fileList,a.directory,a.displayIcons,a.viewName)).replace(/\{directory\}/g,u(a.directory)).replace(/\{linked-path\}/g,htmlPath(a.directory));t(null,p)}))}}function fileSort(e,a){return".."===e.name||".."===a.name?e.name===a.name?0:".."===e.name?-1:1:Number(a.stat&&a.stat.isDirectory())-Number(e.stat&&e.stat.isDirectory())||String(e.name).toLocaleLowerCase().localeCompare(String(a.name).toLocaleLowerCase())}function htmlPath(e){var a=e.split("/");var t=new Array(a.length);for(var n=0;n<a.length;n++){var p=a[n];if(p){a[n]=encodeURIComponent(p);t[n]='<a href="'+u(a.slice(0,n+1).join("/"))+'">'+u(p)+"</a>"}}return t.join(" / ")}function iconLookup(e){var a=x(e);if(H[a])return{className:"icon-"+a.substring(1),fileName:H[a]};var t=N.lookup(a);if(false===t)return{className:"icon-default",fileName:H.default};if(H[t])return{className:"icon-"+t.replace("/","-"),fileName:H[t]};var n=t.split("+")[1];if(n&&H["+"+n])return{className:"icon-"+n,fileName:H["+"+n]};var p=t.split("/")[0];return H[p]?{className:"icon-"+p,fileName:H[p]}:{className:"icon-default",fileName:H.default}}function iconStyle(e,a){if(!a)return"";var t;var n=[];var p={};var i;var r={};var o="";for(t=0;t<e.length;t++){var s=e[t];var c=s.stat&&s.stat.isDirectory();var l=c?{className:"icon-directory",fileName:H.folder}:iconLookup(s.name);var g=l.fileName;i="#files ."+l.className+" .name";if(!p[g]){p[g]="background-image: url(data:image/png;base64,"+load(g)+");";r[g]=[];n.push(g)}-1===r[g].indexOf(i)&&r[g].push(i)}for(t=0;t<n.length;t++){g=n[t];o+=r[g].join(",\n")+" {\n  "+p[g]+"\n}\n"}return o}function load(e){return I[e]?I[e]:I[e]=_.readFileSync(new URL(import.meta.url.slice(0,import.meta.url.lastIndexOf("/"))).pathname+"/public/icons/"+e,"base64")}function normalizeSlashes(e){return e.split(w).join("/")}function removeHidden(e){return e.filter((function(e){return"."!=e[0]}))}function send(e,a,t){e.setHeader("X-Content-Type-Options","nosniff");e.setHeader("Content-Type",a+"; charset=utf-8");e.setHeader("Content-Length",g.byteLength(t,"utf8"));e.end(t,"utf8")}function stat(e,a,t){var n=new y;n.concurrency(10);a.forEach((function(a){n.push((function(t){_.stat(b(e,a),(function(e,a){if(e&&"ENOENT"!==e.code)return t(e);t(null,a||null)}))}))}));n.end(t)}var H={default:"page_white.png",folder:"folder.png",image:"image.png",text:"page_white_text.png",video:"film.png","+json":"page_white_code.png","+xml":"page_white_code.png","+zip":"box.png","application/font-woff":"font.png","application/javascript":"page_white_code_red.png","application/json":"page_white_code.png","application/msword":"page_white_word.png","application/pdf":"page_white_acrobat.png","application/postscript":"page_white_vector.png","application/rtf":"page_white_word.png","application/vnd.ms-excel":"page_white_excel.png","application/vnd.ms-powerpoint":"page_white_powerpoint.png","application/vnd.oasis.opendocument.presentation":"page_white_powerpoint.png","application/vnd.oasis.opendocument.spreadsheet":"page_white_excel.png","application/vnd.oasis.opendocument.text":"page_white_word.png","application/x-7z-compressed":"box.png","application/x-sh":"application_xp_terminal.png","application/x-font-ttf":"font.png","application/x-msaccess":"page_white_database.png","application/x-shockwave-flash":"page_white_flash.png","application/x-sql":"page_white_database.png","application/x-tar":"box.png","application/x-xz":"box.png","application/xml":"page_white_code.png","application/zip":"box.png","image/svg+xml":"page_white_vector.png","text/css":"page_white_code.png","text/html":"page_white_code.png","text/less":"page_white_code.png",".accdb":"page_white_database.png",".apk":"box.png",".app":"application_xp.png",".as":"page_white_actionscript.png",".asp":"page_white_code.png",".aspx":"page_white_code.png",".bat":"application_xp_terminal.png",".bz2":"box.png",".c":"page_white_c.png",".cab":"box.png",".cfm":"page_white_coldfusion.png",".clj":"page_white_code.png",".cc":"page_white_cplusplus.png",".cgi":"application_xp_terminal.png",".cpp":"page_white_cplusplus.png",".cs":"page_white_csharp.png",".db":"page_white_database.png",".dbf":"page_white_database.png",".deb":"box.png",".dll":"page_white_gear.png",".dmg":"drive.png",".docx":"page_white_word.png",".erb":"page_white_ruby.png",".exe":"application_xp.png",".fnt":"font.png",".gam":"controller.png",".gz":"box.png",".h":"page_white_h.png",".ini":"page_white_gear.png",".iso":"cd.png",".jar":"box.png",".java":"page_white_cup.png",".jsp":"page_white_cup.png",".lua":"page_white_code.png",".lz":"box.png",".lzma":"box.png",".m":"page_white_code.png",".map":"map.png",".msi":"box.png",".mv4":"film.png",".otf":"font.png",".pdb":"page_white_database.png",".php":"page_white_php.png",".pl":"page_white_code.png",".pkg":"box.png",".pptx":"page_white_powerpoint.png",".psd":"page_white_picture.png",".py":"page_white_code.png",".rar":"box.png",".rb":"page_white_ruby.png",".rm":"film.png",".rom":"controller.png",".rpm":"box.png",".sass":"page_white_code.png",".sav":"controller.png",".scss":"page_white_code.png",".srt":"page_white_text.png",".tbz2":"box.png",".tgz":"box.png",".tlz":"box.png",".vb":"page_white_code.png",".vbs":"page_white_code.png",".xcf":"page_white_picture.png",".xlsx":"page_white_excel.png",".yaws":"page_white_code.png"};var E=l;export default E;

