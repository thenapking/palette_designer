// event-stream@3.3.4 downloaded from https://ga.jspm.io/npm:event-stream@3.3.4/index.js

import e from"stream";import t from"through";import r from"from";import n from"duplexer";import i from"map-stream";import o from"pause-stream";import a from"split";import u from"stream-combiner";import f from"buffer";import s from"process";var c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var l={};var m=f.Buffer;var d=s;var p=e.Stream,h=l,y=t,g=r,w=n,v=i,b=o,x=a,E=u,S=c.setImmediate||d.nextTick;h.Stream=p;h.through=y;h.from=g;h.duplex=w;h.map=v;h.pause=b;h.split=x;h.pipeline=h.connect=h.pipe=E;h.concat=h.merge=function(){var e=[].slice.call(arguments);1===e.length&&e[0]instanceof Array&&(e=e[0]);var t=new p;t.setMaxListeners(0);var r=0;t.writable=t.readable=true;e.length?e.forEach((function(n){n.pipe(t,{end:false});var i=false;n.on("end",(function(){if(!i){i=true;r++;r==e.length&&t.emit("end")}}))})):d.nextTick((function(){t.emit("end")}));t.write=function(e){this.emit("data",e)};t.destroy=function(){e.forEach((function(e){e.destroy&&e.destroy()}))};return t};h.writeArray=function(e){if("function"!==typeof e)throw new Error("function writeArray (done): done must be function");var t=new p,r=[],n=false;t.write=function(e){r.push(e)};t.end=function(){n=true;e(null,r)};t.writable=true;t.readable=false;t.destroy=function(){t.writable=t.readable=false;n||e(new Error("destroyed before end"),r)};return t};h.readArray=function(e){var t=new p,r=0,n=false,i=false;t.readable=true;t.writable=false;if(!Array.isArray(e))throw new Error("event-stream.read expects an array");t.resume=function(){if(!i){n=false;var o=e.length;while(r<o&&!n&&!i)t.emit("data",e[r++]);r!=o||i||(i=true,t.readable=false,t.emit("end"))}};d.nextTick(t.resume);t.pause=function(){n=true};t.destroy=function(){i=true;t.emit("close")};return t};h.readable=function(e,t){var r=new p,n=0,i=false,o=false,a=false;r.readable=true;r.writable=false;if("function"!==typeof e)throw new Error("event-stream.readable expects async function");r.on("end",(function(){o=true}));function get(u,f){if(u){r.emit("error",u);t||r.emit("end")}else arguments.length>1&&r.emit("data",f);S((function(){if(!(o||i||a))try{a=true;e.call(r,n++,(function(){a=false;get.apply(null,arguments)}))}catch(e){r.emit("error",e)}}))}r.resume=function(){i=false;get()};d.nextTick(get);r.pause=function(){i=true};r.destroy=function(){r.emit("end");r.emit("close");o=true};return r};h.mapSync=function(e){return h.through((function write(t){var r;try{r=e(t)}catch(e){return this.emit("error",e)}void 0!==r&&this.emit("data",r)}))};h.log=function(e){return h.through((function(t){var r=[].slice.call(arguments);e?console.error(e,t):console.error(t);this.emit("data",t)}))};h.child=function(e){return h.duplex(e.stdin,e.stdout)};h.parse=function(e){var t=!!(!!e&&e.error);return h.through((function(e){var r;try{e&&(r=JSON.parse(e.toString()))}catch(r){return t?this.emit("error",r):console.error(r,"attempting to parse:",e)}void 0!==r&&this.emit("data",r)}))};h.stringify=function(){var e=f.Buffer;return h.mapSync((function(t){return JSON.stringify(e.isBuffer(t)?t.toString():t)+"\n"}))};h.replace=function(e,t){return h.pipeline(h.split(e),h.join(t))};h.join=function(e){if("function"===typeof e)return h.wait(e);var t=true;return h.through((function(r){t||this.emit("data",e);t=false;this.emit("data",r);return true}))};h.wait=function(e){var t=[];return h.through((function(e){t.push(e)}),(function(){var r=m.isBuffer(t[0])?m.concat(t):t.join("");this.emit("data",r);this.emit("end");e&&e(null,r)}))};h.pipeable=function(){throw new Error("[EVENT-STREAM] es.pipeable is deprecated")};export default l;

