// map-stream@0.1.0 downloaded from https://ga.jspm.io/npm:map-stream@0.1.0/index.js

import e from"stream";import r from"process";var t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var a={};var n=r;var i=e.Stream;a=function(e,r){var a=new i,f=this||t,u=0,l=0,o=false,s=false,p=false,d=0,c=false;(this||t).opts=r||{};var m=(this||t).opts.failures?"failure":"error";var v={};a.writable=true;a.readable=true;function queueData(e,r){var t=d+1;if(r===t){void 0!==e&&a.emit.apply(a,["data",e]);d++;t++}else v[r]=e;if(v.hasOwnProperty(t)){var n=v[t];delete v[t];return queueData(n,t)}l++;if(u===l){s&&(s=false,a.emit("drain"));o&&end()}}function next(e,r,t){if(!p){c=true;e&&!f.opts.failures||queueData(r,t);e&&a.emit.apply(a,[m,e]);c=false}}function wrappedMapper(r,t,a){return e.call(null,r,(function(e,r){a(e,r,t)}))}a.write=function(e){if(o)throw new Error("map stream is not writable");c=false;u++;try{var r=wrappedMapper(e,u,next);s=false===r;return!s}catch(e){if(c)throw e;next(e);return!s}};function end(e){o=true;a.writable=false;if(void 0!==e)return queueData(e,u);u==l&&(a.readable=false,a.emit("end"),a.destroy())}a.end=function(e){o||end()};a.destroy=function(){o=p=true;a.writable=a.readable=s=false;n.nextTick((function(){a.emit("close")}))};a.pause=function(){s=true};a.resume=function(){s=false};return a};var f=a;export default f;

