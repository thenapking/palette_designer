// connect@3.7.0 downloaded from https://ga.jspm.io/npm:connect@3.7.0/index.js

import r from"debug";import e from"events";import t from"finalhandler";import n from"http";import a from"utils-merge";import o from"parseurl";import i from"process";var l={};var s=i;var u=r("connect:dispatcher");var f=e.EventEmitter;var p=t;var v=n;var c=a;var h=o;l=createServer;var g="production"||"development";var m={};var d="function"===typeof s.nextTick?s.nextTick:function(r){s.nextTick(r.bind.apply(r,arguments))};function createServer(){function app(r,e,t){app.handle(r,e,t)}c(app,m);c(app,f.prototype);app.route="/";app.stack=[];return app}m.use=function use(r,e){var t=e;var n=r;if("string"!==typeof r){t=r;n="/"}if("function"===typeof t.handle){var a=t;a.route=n;t=function(r,e,t){a.handle(r,e,t)}}t instanceof v.Server&&(t=t.listeners("request")[0]);"/"===n[n.length-1]&&(n=n.slice(0,-1));u("use %s %s",n||"/",t.name||"anonymous");this.stack.push({route:n,handle:t});return this};m.handle=function handle(r,e,t){var n=0;var a=getProtohost(r.url)||"";var o="";var i=false;var l=this.stack;var s=t||p(r,e,{env:g,onerror:logerror});r.originalUrl=r.originalUrl||r.url;function next(t){if(i){r.url=r.url.substr(1);i=false}if(0!==o.length){r.url=a+o+r.url.substr(a.length);o=""}var u=l[n++];if(u){var f=h(r).pathname||"/";var p=u.route;if(f.toLowerCase().substr(0,p.length)!==p.toLowerCase())return next(t);var v=f.length>p.length&&f[p.length];if(v&&"/"!==v&&"."!==v)return next(t);if(0!==p.length&&"/"!==p){o=p;r.url=a+r.url.substr(a.length+o.length);if(!a&&"/"!==r.url[0]){r.url="/"+r.url;i=true}}call(u.handle,p,t,r,e,next)}else d(s,t)}next()};m.listen=function listen(){var r=v.createServer(this);return r.listen.apply(r,arguments)};function call(r,e,t,n,a,o){var i=r.length;var l=t;var s=Boolean(t);u("%s %s : %s",r.name||"<anonymous>",e,n.originalUrl);try{if(s&&4===i){r(t,n,a,o);return}if(!s&&i<4){r(n,a,o);return}}catch(r){l=r}o(l)}function logerror(r){"test"!==g&&console.error(r.stack||r.toString())}function getProtohost(r){if(0!==r.length&&"/"!==r[0]){var e=r.indexOf("://");return-1!==e&&-1===r.lastIndexOf("?",e)?r.substr(0,r.indexOf("/",3+e)):void 0}}var x=l;export default x;

