// finalhandler@1.1.2 downloaded from https://ga.jspm.io/npm:finalhandler@1.1.2/index.js

import e from"debug";import t from"encodeurl";import r from"escape-html";import n from"on-finished";import a from"parseurl";import o from"statuses";import s from"unpipe";import u from"process";import i from"buffer";var d={};var f=i.Buffer;var c=u;var m=e("finalhandler");var p=t;var l=r;var v=n;var h=a;var g=o;var y=s;var b=/\x20{2}/g;var C=/\n/g;var H="function"===typeof c.nextTick?c.nextTick:function(e){c.nextTick(e.bind.apply(e,arguments))};var S=v.isFinished;function createHtmlDocument(e){var t=l(e).replace(C,"<br>").replace(b," &nbsp;");return"<!DOCTYPE html>\n"+'<html lang="en">\n'+"<head>\n"+'<meta charset="utf-8">\n'+"<title>Error</title>\n"+"</head>\n"+"<body>\n"+"<pre>"+t+"</pre>\n"+"</body>\n"+"</html>\n"}d=finalhandler;function finalhandler(e,t,r){var n=r||{};var a=n.env||"production"||"development";var o=n.onerror;return function(r){var n;var s;var u;if(r||!headersSent(t)){if(r){u=getErrorStatusCode(r);void 0===u?u=getResponseStatusCode(t):n=getErrorHeaders(r);s=getErrorMessage(r,u,a)}else{u=404;s="Cannot "+e.method+" "+p(getResourceName(e))}m("default %s",u);r&&o&&H(o,r,e,t);if(headersSent(t)){m("cannot %d after headers sent",u);e.socket.destroy()}else send(e,t,u,n,s)}else m("cannot 404 after headers sent")}}function getErrorHeaders(e){if(e.headers&&"object"===typeof e.headers){var t=Object.create(null);var r=Object.keys(e.headers);for(var n=0;n<r.length;n++){var a=r[n];t[a]=e.headers[a]}return t}}function getErrorMessage(e,t,r){var n;if("production"!==r){n=e.stack;n||"function"!==typeof e.toString||(n=e.toString())}return n||g[t]}function getErrorStatusCode(e){return"number"===typeof e.status&&e.status>=400&&e.status<600?e.status:"number"===typeof e.statusCode&&e.statusCode>=400&&e.statusCode<600?e.statusCode:void 0}function getResourceName(e){try{return h.original(e).pathname}catch(e){return"resource"}}function getResponseStatusCode(e){var t=e.statusCode;("number"!==typeof t||t<400||t>599)&&(t=500);return t}function headersSent(e){return"boolean"!==typeof e.headersSent?Boolean(e._header):e.headersSent}function send(e,t,r,n,a){function write(){var o=createHtmlDocument(a);t.statusCode=r;t.statusMessage=g[r];setHeaders(t,n);t.setHeader("Content-Security-Policy","default-src 'none'");t.setHeader("X-Content-Type-Options","nosniff");t.setHeader("Content-Type","text/html; charset=utf-8");t.setHeader("Content-Length",f.byteLength(o,"utf8"));"HEAD"!==e.method?t.end(o,"utf8"):t.end()}if(S(e))write();else{y(e);v(e,write);e.resume()}}function setHeaders(e,t){if(t){var r=Object.keys(t);for(var n=0;n<r.length;n++){var a=r[n];e.setHeader(a,t[a])}}}var E=d;export default E;

