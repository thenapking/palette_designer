// morgan@1.10.0 downloaded from https://ga.jspm.io/npm:morgan@1.10.0/index.js

import e from"basic-auth";import t from"debug";import r from"depd";import n from"on-finished";import o from"on-headers";import a from"process";var i={};var s=a;i=morgan;i.compile=compile;i.format=format;i.token=token;var m=e;var u=t("morgan");var f=r("morgan");var g=n;var d=o;var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var l=1e3;function morgan(e,t){var r=e;var n=t||{};if(e&&"object"===typeof e){n=e;r=n.format||"default";f("morgan(options): use morgan("+("string"===typeof r?JSON.stringify(r):"format")+", options) instead")}void 0===r&&f("undefined format: specify a format");var o=n.immediate;var a=n.skip||false;var i="function"!==typeof r?getFormatFunction(r):r;var m=n.buffer;var c=n.stream||s.stdout;if(m){f("buffer option");var v="number"!==typeof m?l:m;c=createBufferStream(c,v)}return function logger(e,t,r){e._startAt=void 0;e._startTime=void 0;e._remoteAddress=getip(e);t._startAt=void 0;t._startTime=void 0;recordStartTime.call(e);function logRequest(){if(false!==a&&a(e,t))u("skip request");else{var r=i(morgan,e,t);if(null!=r){u("log request");c.write(r+"\n")}else u("skip line")}}if(o)logRequest();else{d(t,recordStartTime);g(t,logRequest)}r()}}morgan.format("combined",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"');morgan.format("common",':remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length]');morgan.format("default",':remote-addr - :remote-user [:date] ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent"');f.property(morgan,"default","default format: use combined format");morgan.format("short",":remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms");morgan.format("tiny",":method :url :status :res[content-length] - :response-time ms");morgan.format("dev",(function developmentFormatLine(e,t,r){var n=headersSent(r)?r.statusCode:void 0;var o=n>=500?31:n>=400?33:n>=300?36:n>=200?32:0;var a=developmentFormatLine[o];a||(a=developmentFormatLine[o]=compile("[0m:method :url ["+o+"m:status[0m :response-time ms - :res[content-length][0m"));return a(e,t,r)}));morgan.token("url",(function getUrlToken(e){return e.originalUrl||e.url}));morgan.token("method",(function getMethodToken(e){return e.method}));morgan.token("response-time",(function getResponseTimeToken(e,t,r){if(e._startAt&&t._startAt){var n=1e3*(t._startAt[0]-e._startAt[0])+1e-6*(t._startAt[1]-e._startAt[1]);return n.toFixed(void 0===r?3:r)}}));morgan.token("total-time",(function getTotalTimeToken(e,t,r){if(e._startAt&&t._startAt){var n=s.hrtime(e._startAt);var o=1e3*n[0]+1e-6*n[1];return o.toFixed(void 0===r?3:r)}}));morgan.token("date",(function getDateToken(e,t,r){var n=new Date;switch(r||"web"){case"clf":return clfdate(n);case"iso":return n.toISOString();case"web":return n.toUTCString()}}));morgan.token("status",(function getStatusToken(e,t){return headersSent(t)?String(t.statusCode):void 0}));morgan.token("referrer",(function getReferrerToken(e){return e.headers.referer||e.headers.referrer}));morgan.token("remote-addr",getip);morgan.token("remote-user",(function getRemoteUserToken(e){var t=m(e);return t?t.name:void 0}));morgan.token("http-version",(function getHttpVersionToken(e){return e.httpVersionMajor+"."+e.httpVersionMinor}));morgan.token("user-agent",(function getUserAgentToken(e){return e.headers["user-agent"]}));morgan.token("req",(function getRequestToken(e,t,r){var n=e.headers[r.toLowerCase()];return Array.isArray(n)?n.join(", "):n}));morgan.token("res",(function getResponseHeader(e,t,r){if(headersSent(t)){var n=t.getHeader(r);return Array.isArray(n)?n.join(", "):n}}));function clfdate(e){var t=e.getUTCDate();var r=e.getUTCHours();var n=e.getUTCMinutes();var o=e.getUTCSeconds();var a=e.getUTCFullYear();var i=c[e.getUTCMonth()];return pad2(t)+"/"+i+"/"+a+":"+pad2(r)+":"+pad2(n)+":"+pad2(o)+" +0000"}function compile(e){if("string"!==typeof e)throw new TypeError("argument format must be a string");var t=String(JSON.stringify(e));var r='  "use strict"\n  return '+t.replace(/:([-\w]{2,})(?:\[([^\]]+)\])?/g,(function(e,t,r){var n="req, res";var o="tokens["+String(JSON.stringify(t))+"]";void 0!==r&&(n+=", "+String(JSON.stringify(r)));return'" +\n    ('+o+"("+n+') || "-") + "'}));return new Function("tokens, req, res",r)}function createBufferStream(e,t){var r=[];var n=null;function flush(){n=null;e.write(r.join(""));r.length=0}function write(e){null===n&&(n=setTimeout(flush,t));r.push(e)}return{write:write}}function format(e,t){morgan[e]=t;return this}function getFormatFunction(e){var t=morgan[e]||e||morgan.default;return"function"!==typeof t?compile(t):t}function getip(e){return e.ip||e._remoteAddress||e.connection&&e.connection.remoteAddress||void 0}function headersSent(e){return"boolean"!==typeof e.headersSent?Boolean(e._header):e.headersSent}function pad2(e){var t=String(e);return(1===t.length?"0":"")+t}function recordStartTime(){this._startAt=s.hrtime();this._startTime=new Date}function token(e,t){morgan[e]=t;return this}var v=i;const p=i.compile,h=i.format,T=i.token;export default v;export{p as compile,h as format,T as token};

