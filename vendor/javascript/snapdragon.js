// snapdragon@0.8.2 downloaded from https://ga.jspm.io/npm:snapdragon@0.8.2/index.js

import t from"base";import i from"define-property";import s from"use";import r from"debug";import e from"extend-shallow";import n from"source-map";import o from"source-map-resolve";import a from"fs";import p from"path";import h from"util";import u from"map-cache";var c={};c.extend=e;c.SourceMap=n;c.sourceMapResolve=o;c.unixify=function(t){return t.split(/\\+/).join("/")};c.isString=function(t){return t&&"string"===typeof t};c.arrayify=function(t){return"string"===typeof t?[t]:t?Array.isArray(t)?t:[t]:[]};c.last=function(t,i){return t[t.length-(i||1)]};var l={};var f=a;var v=p;var m=i;var d=c;l=mixin;function mixin(t){m(t,"_comment",t.comment);t.map=new d.SourceMap.SourceMapGenerator;t.position={line:1,column:1};t.content={};t.files={};for(var i in l)m(t,i,l[i])}l.updatePosition=function(t){var i=t.match(/\n/g);i&&(this.position.line+=i.length);var s=t.lastIndexOf("\n");this.position.column=~s?t.length-s:this.position.column+t.length};l.emit=function(t,i){var s=i.position||{};var r=s.source;if(r){s.filepath&&(r=d.unixify(s.filepath));this.map.addMapping({source:r,generated:{line:this.position.line,column:Math.max(this.position.column-1,0)},original:{line:s.start.line,column:s.start.column-1}});s.content&&this.addContent(r,s);s.filepath&&this.addFile(r,s);this.updatePosition(t);this.output+=t}return t};l.addFile=function(t,i){"string"===typeof i.content&&(Object.prototype.hasOwnProperty.call(this.files,t)||(this.files[t]=i.content))};l.addContent=function(t,i){"string"===typeof i.content&&(Object.prototype.hasOwnProperty.call(this.content,t)||this.map.setSourceContent(t,i.content))};l.applySourceMaps=function(){Object.keys(this.files).forEach((function(t){var i=this.files[t];this.map.setSourceContent(t,i);if(true===this.options.inputSourcemaps){var s=d.sourceMapResolve.resolveSync(i,t,f.readFileSync);if(s){var r=new d.SourceMap.SourceMapConsumer(s.map);var e=s.sourcesRelativeTo;this.map.applySourceMap(r,t,d.unixify(v.dirname(e)))}}}),this)};l.comment=function(t){return/^# sourceMappingURL=/.test(t.comment)?this.emit("",t.position):this._comment(t)};var y=l;var g={};var x=s;var w=i;var S=r("snapdragon:compiler");var P=c;function Compiler(t,i){S("initializing",new URL(import.meta.url).pathname);this.options=P.extend({source:"string"},t);this.state=i||{};this.compilers={};this.output="";this.set("eos",(function(t){return this.emit(t.val,t)}));this.set("noop",(function(t){return this.emit(t.val,t)}));this.set("bos",(function(t){return this.emit(t.val,t)}));x(this)}Compiler.prototype={error:function(t,i){var s=i.position||{start:{column:0}};var r=this.options.source+" column:"+s.start.column+": "+t;var e=new Error(r);e.reason=t;e.column=s.start.column;e.source=this.pattern;if(!this.options.silent)throw e;this.errors.push(e)},define:function(t,i){w(this,t,i);return this},emit:function(t,i){this.output+=t;return t},set:function(t,i){this.compilers[t]=i;return this},get:function(t){return this.compilers[t]},prev:function(t){return this.ast.nodes[this.idx-(t||1)]||{type:"bos",val:""}},next:function(t){return this.ast.nodes[this.idx+(t||1)]||{type:"eos",val:""}},visit:function(t,i,s){var r=this.compilers[t.type];this.idx=s;if("function"!==typeof r)throw this.error('compiler "'+t.type+'" is not registered',t);return r.call(this,t,i,s)},mapVisit:function(t){if(!Array.isArray(t))throw new TypeError("expected an array");var i=t.length;var s=-1;while(++s<i)this.visit(t[s],t,s);return this},compile:function(t,i){var s=P.extend({},this.options,i);this.ast=t;this.parsingErrors=this.ast.errors;this.output="";if(s.sourcemap){var r=y;r(this);this.mapVisit(this.ast.nodes);this.applySourceMaps();this.map="generator"===s.sourcemap?this.map:this.map.toJSON();return this}this.mapVisit(this.ast.nodes);return this}};g=Compiler;var b=g;var C={};var O=i;C=function Position(t,i){this.start=t;this.end={line:i.line,column:i.column};O(this,"content",i.orig);O(this,"source",i.options.source)};var M=C;var k={};var E=s;var j=h;var T=u;var R=i;var V=r("snapdragon:parser");var A=M;var D=c;function Parser(t){V("initializing",new URL(import.meta.url).pathname);this.options=D.extend({source:"string"},t);this.init(this.options);E(this)}Parser.prototype={constructor:Parser,init:function(t){this.orig="";this.input="";this.parsed="";this.column=1;this.line=1;this.regex=new T;this.errors=this.errors||[];this.parsers=this.parsers||{};this.types=this.types||[];this.sets=this.sets||{};this.fns=this.fns||[];this.currentType="root";var i=this.position();this.bos=i({type:"bos",val:""});this.ast={type:"root",errors:this.errors,nodes:[this.bos]};R(this.bos,"parent",this.ast);this.nodes=[this.ast];this.count=0;this.setCount=0;this.stack=[]},error:function(t,i){var s=i.position||{start:{column:0,line:0}};var r=s.start.line;var e=s.start.column;var n=this.options.source;var o=n+" <line:"+r+" column:"+e+">: "+t;var a=new Error(o);a.source=n;a.reason=t;a.pos=s;if(!this.options.silent)throw a;this.errors.push(a)},define:function(t,i){R(this,t,i);return this},position:function(){var t={line:this.line,column:this.column};var i=this;return function(s){R(s,"position",new A(t,i));return s}},set:function(t,i){-1===this.types.indexOf(t)&&this.types.push(t);this.parsers[t]=i.bind(this);return this},get:function(t){return this.parsers[t]},push:function(t,i){this.sets[t]=this.sets[t]||[];this.count++;this.stack.push(i);return this.sets[t].push(i)},pop:function(t){this.sets[t]=this.sets[t]||[];this.count--;this.stack.pop();return this.sets[t].pop()},isInside:function(t){this.sets[t]=this.sets[t]||[];return this.sets[t].length>0},isType:function(t,i){return t&&t.type===i},prev:function(t){return this.stack.length>0?D.last(this.stack,t):D.last(this.nodes,t)},consume:function(t){this.input=this.input.substr(t)},updatePosition:function(t,i){var s=t.match(/\n/g);s&&(this.line+=s.length);var r=t.lastIndexOf("\n");this.column=~r?i-r:this.column+i;this.parsed+=t;this.consume(i)},match:function(t){var i=t.exec(this.input);if(i){this.updatePosition(i[0],i[0].length);return i}},capture:function(t,i){if("function"===typeof i)return this.set.apply(this,arguments);this.regex.set(t,i);this.set(t,function(){var s=this.parsed;var r=this.position();var e=this.match(i);if(e&&e[0]){var n=this.prev();var o=r({type:t,val:e[0],parsed:s,rest:this.input});e[1]&&(o.inner=e[1]);R(o,"inside",this.stack.length>0);R(o,"parent",n);n.nodes.push(o)}}.bind(this));return this},capturePair:function(t,i,s,r){this.sets[t]=this.sets[t]||[];this.set(t+".open",(function(){var s=this.parsed;var e=this.position();var n=this.match(i);if(n&&n[0]){var o=n[0];this.setCount++;this.specialChars=true;var a=e({type:t+".open",val:o,rest:this.input});"undefined"!==typeof n[1]&&(a.inner=n[1]);var p=this.prev();var h=e({type:t,nodes:[a]});R(h,"rest",this.input);R(h,"parsed",s);R(h,"prefix",n[1]);R(h,"parent",p);R(a,"parent",h);"function"===typeof r&&r.call(this,a,h);this.push(t,h);p.nodes.push(h)}}));this.set(t+".close",(function(){var i=this.position();var r=this.match(s);if(r&&r[0]){var e=this.pop(t);var n=i({type:t+".close",rest:this.input,suffix:r[1],val:r[0]});if(!this.isType(e,t)){if(this.options.strict)throw new Error('missing opening "'+t+'"');this.setCount--;n.escaped=true;return n}if("\\"===n.suffix){e.escaped=true;n.escaped=true}e.nodes.push(n);R(n,"parent",e)}}));return this},eos:function(){var t=this.position();if(!this.input){var i=this.prev();while("root"!==i.type&&!i.visited){if(true===this.options.strict)throw new SyntaxError("invalid syntax:"+j.inspect(i,null,2));if(!hasDelims(i)){i.parent.escaped=true;i.escaped=true}visit(i,(function(t){if(!hasDelims(t.parent)){t.parent.escaped=true;t.escaped=true}}));i=i.parent}var s=t({type:"eos",val:this.append||""});R(s,"parent",this.ast);return s}},next:function(){var t=this.parsed;var i=this.types.length;var s=-1;var r;while(++s<i)if(r=this.parsers[this.types[s]].call(this)){R(r,"rest",this.input);R(r,"parsed",t);this.last=r;return r}},parse:function(t){if("string"!==typeof t)throw new TypeError("expected a string");this.init(this.options);this.orig=t;this.input=t;var i=this;function parse(){t=i.input;var s=i.next();if(s){var r=i.prev();if(r){R(s,"parent",r);r.nodes&&r.nodes.push(s)}i.sets.hasOwnProperty(r.type)&&(i.currentType=r.type)}if(i.input&&t===i.input)throw new Error('no parsers registered for: "'+i.input.slice(0,5)+'"')}while(this.input)parse();if(this.stack.length&&this.options.strict){var s=this.stack.pop();throw this.error("missing opening "+s.type+': "'+this.orig+'"')}var r=this.eos();var e=this.prev();"eos"!==e.type&&this.ast.nodes.push(r);return this.ast}};function visit(t,i){if(!t.visited){R(t,"visited",true);return t.nodes?mapVisit(t.nodes,i):i(t)}return t}function mapVisit(t,i){var s=t.length;var r=-1;while(++r<s)visit(t[r],i)}function hasOpen(t){return t.nodes&&t.nodes[0].type===t.type+".open"}function hasClose(t){return t.nodes&&D.last(t.nodes).type===t.type+".close"}function hasDelims(t){return hasOpen(t)&&hasClose(t)}k=Parser;var F=k;var I={};var L=t;var U=i;var z=b;var _=F;var G=c;var J={};var N={};function Snapdragon(t){L.call(this,null,t);this.options=G.extend({source:"string"},this.options);this.compiler=new z(this.options);this.parser=new _(this.options);Object.defineProperty(this,"compilers",{get:function(){return this.compiler.compilers}});Object.defineProperty(this,"parsers",{get:function(){return this.parser.parsers}});Object.defineProperty(this,"regex",{get:function(){return this.parser.regex}})}L.extend(Snapdragon);Snapdragon.prototype.capture=function(){return this.parser.capture.apply(this.parser,arguments)};Snapdragon.prototype.use=function(t){t.call(this,this);return this};Snapdragon.prototype.parse=function(t,i){this.options=G.extend({},this.options,i);var s=this.parser.parse(t,this.options);U(s,"parser",this.parser);return s};Snapdragon.prototype.compile=function(t,i){this.options=G.extend({},this.options,i);var s=this.compiler.compile(t,this.options);U(s,"compiler",this.compiler);return s};I=Snapdragon;I.Compiler=z;I.Parser=_;var q=I;const B=I.Compiler,H=I.Parser;export default q;export{B as Compiler,H as Parser};

