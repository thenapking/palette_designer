// proxy-middleware@0.15.0 downloaded from https://ga.jspm.io/npm:proxy-middleware@0.15.0/index.js

import e from"os";import r from"http";import a from"https";import t from"url";var o={};var n=e;var i=r;var s=a;var h={}.hasOwnProperty;o=function proxyMiddleware(e){"string"===typeof e&&(e=t.parse(e));var r="https:"===e.protocol?s:i;var a=r.request;e=e||{};e.hostname=e.hostname;e.port=e.port;e.pathname=e.pathname||"/";return function(r,t,o){var n=r.url;if("string"===typeof e.route)if(n===e.route)n="";else{if(n.slice(0,e.route.length)!==e.route)return o();n=n.slice(e.route.length)}var i=extend({},e);n&&"?"===n.charAt(0)?e.pathname.length>1&&"/"===e.pathname.charAt(e.pathname.length-1)?i.path=e.pathname.substring(0,e.pathname.length-1)+n:i.path=e.pathname+n:i.path=n?slashJoin(e.pathname,n):e.pathname;i.method=r.method;i.headers=e.headers?merge(r.headers,e.headers):r.headers;applyViaHeader(r.headers,i,i.headers);e.preserveHost||delete i.headers.host;var s=a(i,(function(a){var n=a.statusCode,s=a.headers,h=s.location;(n>300&&n<304||201===n)&&h&&h.indexOf(e.href)>-1&&(s.location=h.replace(e.href,slashJoin("/",slashJoin(e.route||"",""))));applyViaHeader(a.headers,i,a.headers);rewriteCookieHosts(a.headers,i,a.headers,r);t.writeHead(a.statusCode,a.headers);a.on("error",(function(e){o(e)}));a.pipe(t)}));s.on("error",(function(e){o(e)}));r.readable?r.pipe(s):s.end()}};function applyViaHeader(e,r,a){if(r.via){var t=true===r.via?n.hostname():r.via;var o="1.1 "+t;e.via&&(o=e.via+", "+o);a.via=o}}function rewriteCookieHosts(e,r,a,t){if(r.cookieRewrite&&h.call(e,"set-cookie")){var o=e["set-cookie"],i=[],s=true===r.cookieRewrite?n.hostname():r.cookieRewrite;Array.isArray(o)||(o=[o]);for(var p=0;p<o.length;p++){var l=o[p].replace(/(Domain)=[a-z\.-_]*?(;|$)/gi,"$1="+s+"$2");t.connection.encrypted||(l=l.replace(/;\s*?(Secure)/i,""));i.push(l)}a["set-cookie"]=i}}function slashJoin(e,r){var a=false;e.length&&"/"===e[e.length-1]&&(a=true);a&&r.length&&"/"===r[0]&&(r=r.substring(1));return e+r}function extend(e,r){for(var a in r)h.call(r,a)&&(e[a]=r[a]);return e}function merge(e,r){var a={};extend(a,e);extend(a,r);return a}var p=o;export default p;

